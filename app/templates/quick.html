{% extends 'base.html' %}

{% block title %}Prompt Optimization Web App{% endblock %}

{% block content %}
<div class="text-center">
  <h2>Quick Mode</h2>

  <form method="post" class="mb-4">
    <div class="mb-3">
      <textarea
        class="form-control"
        name="user_input"
        rows="3"
        required
        maxlength="1800"
        placeholder="Enter your prompt, e.g.: 'Help me plan a 7-day trip to Italy'"
      >{{ user_input or '' }}</textarea>
    </div>

    <div class="mb-3">
      <label for="toneSelect" class="form-label">Select Tone:</label>
      <select class="form-select" id="toneSelect" name="tone" required>
        <option value="Standard" {% if selected_tone == 'Standard' %}selected{% endif %}>Standard</option>
        <option value="Technical" {% if selected_tone == 'Technical' %}selected{% endif %}>Technical</option>
        <option value="Informal" {% if selected_tone == 'Informal' %}selected{% endif %}>Informal</option>
        <option value="Custom" {% if selected_tone == 'Custom' %}selected{% endif %}>
          I want to set my own custom tone
        </option>
      </select>
    </div>

    <div
      class="mb-3"
      id="customToneContainer"
      style="{% if selected_tone == 'Custom' %}display:block;{% else %}display:none;{% endif %}"
    >
      <input
        type="text"
        class="form-control"
        id="customToneInput"
        name="custom_tone"
        maxlength="180"
        placeholder="Enter your custom tone (max 180 chars)"
        value="{{ custom_tone or '' }}"
        {% if selected_tone == 'Custom' %}required{% endif %}
      />
    </div>

    <button type="submit" class="btn btn-lg text-white" style="background-color: #6c757d;">Send</button>
  </form>

  {% if response %}
    <hr>
    <div class="mb-3 text-start">
      <h5>Optimized Prompt:</h5>
      <div class="d-flex align-items-start">
        <div
          id="optimizedPrompt"
          class="alert alert-secondary flex-grow-1"
          style="white-space: pre-wrap;"
        >{{ response }}</div>
        <button
          id="copyBtn"
          class="btn btn-secondary ms-2"
          type="button"
        >Copy</button>
      </div>
    </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const toneSelect = document.getElementById('toneSelect');
    const customContainer = document.getElementById('customToneContainer');
    const customInput = document.getElementById('customToneInput');

    // Show/hide custom-tone box
    toneSelect.addEventListener('change', function() {
      if (toneSelect.value === 'Custom') {
        customContainer.style.display = 'block';
        customInput.required = true;
      } else {
        customContainer.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
      }
    });

    // Copy button logic
    const copyBtn = document.getElementById('copyBtn');
    const optimizedPrompt = document.getElementById('optimizedPrompt');
    if (copyBtn && optimizedPrompt) {
      copyBtn.addEventListener('click', function() {
        const text = optimizedPrompt.innerText;
        navigator.clipboard.writeText(text)
          .then(() => {
            copyBtn.textContent = 'Copied!';
            setTimeout(() => { copyBtn.textContent = 'Copy'; }, 2000);
          })
          .catch(err => {
            console.error('Copy failed', err);
          });
      });
    }
  });
</script>
{% endblock %}
